"use strict";(self.webpackChunkHcsImageViewer=self.webpackChunkHcsImageViewer||[]).push([[822],{3404:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ut}});var r=n(7462),o=n(7294),i=n(3935),a=n(4942),c=n(9439),s=n(5697),l=n.n(s),u=n(4035),f=n(1002),p=n(5671),d=n(3144),v=n(1752),h=n(136),y=n(3930),m=n(1120),g=n(5861),b=n(4687),O=n.n(b),w=n(4088),C=n(8918),j=n(3121);function Z(e){var t=e[e.length-1];return 3===t||4===t}function P(e){if(e&&e.shape){var t=Z(e.shape),n=e.shape.slice(t?-3:-2),r=(0,c.Z)(n,2);return{height:r[0],width:r[1]}}}var k,S={x:-1,y:-1},A=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this.props,t=e.loader,n=e.id,r=e.mesh,o=void 0===r?{}:r,i=e.hoveredCell,a=o.cells,c=void 0===a?[]:a,s=o.selected,l=void 0===s?[]:s,u=o.meshSize,f=void 0===u?1:u,p=o.notSelectedAlpha,d=void 0===p?.75:p,v=P(t[0])||{},h=v.width,y=void 0===h?0:h,m=v.height,g=y/f,b=(void 0===m?0:m)/f,O=function(e,t){return[e*g,t*b]},C=function(e,t){return[O(e,t),O(e+1,t),O(e+1,t+1),O(e,t+1)]},Z=function(e){return e&&i&&i.id===e.id},k=c.slice();k.sort((function(e,t){return Number(Z(e))-Number(Z(t))}));var A=new j.Z({id:"line-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:k,getPolygon:function(e){return C(e.x,e.y)},getLineWidth:function(e){return Z(e)?2:1},lineWidthUnits:"pixels",getLineColor:function(e){return Z(e)?[220,220,220]:[220,220,220,50]},filled:!1,stroked:!0,updateTriggers:{getLineColor:[i||S]}}),x=new j.Z({id:"cell-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:c,getPolygon:function(e){return C(e.x,e.y)},filled:!0,stroked:!1,pickable:!0,getFillColor:[255,255,255,0]});return[new j.Z({id:"cell-not-selected-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:c.filter((function(e){return e&&!l.some((function(t){return t.id===e.id}))})),getPolygon:function(e){return C(e.x,e.y)},filled:!0,stroked:!1,getFillColor:[0,0,0,Math.max(0,Math.min(255,Math.round(255*d)))]}),A,x]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t),!0}}]),o}(C.Z);A.layerName="CollageMeshLayer",A.defaultProps={loader:{type:"object",value:{getRaster:(k=(0,g.Z)(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return e.stop()}}),e)}))),function(){return k.apply(this,arguments)}),getRasterSize:function(){return{height:0,width:0}},dtype:"<u2"},compare:!0},id:{type:"string",value:"collage-mesh-layer",compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},mesh:{type:"object",value:{meshSize:0},compare:!0},onHover:{type:"function",value:function(){},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var x=A,R=n(5395),D=n(3693);function L(e){if(!e)return[1,1,1,1];if("object"===(0,f.Z)(e)&&Array.isArray(e)){var t=(0,c.Z)(e,4),n=t[0],r=void 0===n?1:n,o=t[1],i=void 0===o?1:o,a=t[2],s=void 0===a?1:a,l=t[3];return[r,i,s,void 0===l?1:l]}if("string"==typeof e&&/^#/i.test(e)){var u=function(e){return parseInt(e||"FF",16)/255};return[u(e.slice(1,3)),u(e.slice(3,5)),u(e.slice(5,7)),u(e.slice(7,9))]}if("number"==typeof e){var p=function(e){return Math.max(0,Math.min(1,e))};return[p(e),p(e),p(e),1]}return[1,1,1,1]}function E(e){var t=L(e),n=(0,c.Z)(t,4),r=n[0],o=n[1],i=n[2],a=n[3];return[255*r,255*o,255*i,255*(void 0===a?1:a)]}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var o=(0,m.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var M=function(e){(0,h.Z)(n,e);var t=I(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"getShaders",value:function(){return{inject:{"fs:#decl":"uniform float accuracy;","fs:DECKGL_FILTER_COLOR":"\n          if (color.r < accuracy && color.g < accuracy && color.b < accuracy) {\n            // is transparent\n            color = vec4(0.0, 0.0, 0.0, 0.0);\n          }\n        "}}}},{key:"updateState",value:function(e){for(var t=e.props.ignoreColorAccuracy,n=void 0===t?.1:t,r=this.getModels(),o=0;o<r.length;o+=1)r[o].setUniforms({accuracy:n})}}]),n}(D.Z),z=function(e){(0,h.Z)(n,e);var t=I(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"getShaders",value:function(){return{inject:{"fs:#decl":"uniform float accuracy; uniform vec4 tint;","fs:DECKGL_FILTER_COLOR":"\n          if (color.r < accuracy && color.g < accuracy && color.b < accuracy) {\n            // is transparent\n            color = vec4(0.0, 0.0, 0.0, 0.0);\n          } else {\n            color = tint;\n          }\n        "}}}},{key:"updateState",value:function(e){for(var t=e.props,n=t.ignoreColorAccuracy,r=void 0===n?.1:n,o=t.color,i=void 0===o?[1,1,1,1]:o,a=this.getModels(),c=0;c<a.length;c+=1)a[c].setUniforms({accuracy:r,tint:L(i)})}}]),n}(D.Z);var B=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this.props,t=e.loader,n=e.id,r=e.url,o=e.color,i=e.ignoreColor,a=e.ignoreColorAccuracy,c=P(t[0])||{},s=c.width,l=void 0===s?0:s,u=c.height,f=void 0===u?0:u;return[new R.Z({id:"image-layer-".concat(n),image:r,bounds:[0,f,l,0],ignoreColorAccuracy:a,color:o,extensions:[!(!i||o)&&new M,!(!i||!o)&&new z].filter(Boolean)})]}}]),o}(C.Z);B.layerName="ImageOverlayLayer",B.defaultProps={loader:{type:"object",value:{getRaster:function(){var e=(0,g.Z)(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getRasterSize:function(){return{height:0,width:0}},dtype:"<u2"},compare:!0},id:{type:"string",value:"image-overlay-layer",compare:!0},url:{type:"string",value:void 0,compare:!0},color:{type:"string",value:void 0,compare:!0},ignoreColor:{type:"boolean",value:!1,compare:!0},ignoreColorAccuracy:{type:"number",value:.1,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},mesh:{type:"object",value:{rows:0,columns:0},compare:!0},onHover:{type:"function",value:function(){},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var T=B;function V(e){return"-#".concat(e,"#")}var N=n(2112);function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e||[],r=(0,c.Z)(n,4),o=r[0],i=void 0===o?255:o,a=r[1],s=void 0===a?255:a,l=r[2],u=void 0===l?255:l,f=r[3],p=void 0===f?255:f;return[i,s,u,Math.max(0,Math.min(255,p*t))]}function F(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e.lineColor},r=t&&t!==e.identifier;return H(E(n(e)||[220,220,220]),r?.25:1)}var U=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"visibleAnnotations",get:function(){var e=this.props.annotations;return(void 0===e?[]:e).filter((function(e){return void 0===e.visible||e.visible}))}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t?t.identifier:void 0),!0}}]),o}(C.Z);U.layerName="BaseAnnotationLayer",U.defaultProps={id:{type:"string",value:"base-annotation-layer",compare:!0},annotations:{type:"array",value:[],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var W=U;var $=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation,o=function(e){var t=(0,c.Z)(e,2),n=t[0],r=void 0===n?0:n,o=t[1];return[r,void 0===o?0:o]},i=new N.Z({id:"arrows-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:this.visibleAnnotations,getPath:function(t){var n,r,i,a,s,l,u,f,p=(0,c.Z)(t.points,2),d=p[0],v=p[1],h=t.pixels?e.unproject(d):d,y=t.pixels?e.unproject(v):v,m=Math.sqrt(Math.pow(h[0]-y[0],2)+Math.pow(h[1]-y[1],2)),g=Math.min(m,(10,n=e.unproject([0,0]),i=(r=(0,c.Z)(n,2))[0],a=r[1],s=e.unproject([10,0]),u=(l=(0,c.Z)(s,2))[0],f=l[1],Math.sqrt(Math.pow(i-u,2)+Math.pow(a-f,2)))),b=[y[0]-h[0],y[1]-h[1]],O=[-b[1],b[0]],w=function(e){var t=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))}(e);return 0===t?[0,0]:[e[0]/t,e[1]/t]},C=w(b),j=w(O),Z=[y[0]-C[0]*g,y[1]-C[1]*g],P=[Z[0]+j[0]*(g/2),Z[1]+j[1]*(g/2)];return[h,Z,[Z[0]-j[0]*(g/2),Z[1]-j[1]*(g/2)],y,P,Z].map(o)},getWidth:function(){return 2},widthUnits:"pixels",getColor:function(e){return F(e,r)},filled:!1,stroked:!0,pickable:!0,updateTriggers:{getColor:[r]}});return[i]}}]),o}(W);$.layerName="ArrowAnnotationLayer",$.defaultProps={id:{type:"string",value:"arrow-annotation-layer",compare:!0},annotations:{type:"array",value:[{points:[[0,0],[0,0]],pixels:!1,visible:!0,lineColor:[0,0,0]}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var G=$;var _=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation;return[new j.Z({id:"rectangle-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:this.visibleAnnotations,getPolygon:function(t){var n=function(e,n){return[t.center[0]+e*(t.width/2),t.center[1]+n*(t.height/2)]},r=function(n){return function(e){var t=(0,c.Z)(e,2),n=t[0],r=void 0===n?0:n,o=t[1];return[r,void 0===o?0:o]}(t.pixels?e.unproject(n):n)};return[r(n(-1,-1)),r(n(-1,1)),r(n(1,1)),r(n(1,-1))]},getLineWidth:function(){return 2},lineWidthUnits:"pixels",getLineColor:function(e){return F(e,r)},getFillColor:function(){return[0,0,0,0]},filled:!0,stroked:!0,pickable:!0,updateTriggers:{getLineColor:[r]}})]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t?t.identifier:void 0),!0}}]),o}(W);_.layerName="RectangleAnnotationLayer",_.defaultProps={id:{type:"string",value:"rectangle-annotation-layer",compare:!0},annotations:{type:"array",value:[{center:[0,0],width:0,height:0,pixels:!1,visible:!0,lineColor:[0,0,0]}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var q=_,K=n(8569);var Q=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation,o=new K.Z({id:"circles-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:this.visibleAnnotations,getPosition:function(t){return n=t.pixels?e.unproject(t.center):t.center,[void 0===(o=(r=(0,c.Z)(n,2))[0])?0:o,void 0===(i=r[1])?0:i];var n,r,o,i},getRadius:function(t){return t.pixels?(n=t.radius,r=e.unproject([0,0]),i=(o=(0,c.Z)(r,2))[0],a=o[1],s=e.unproject([n,0]),u=(l=(0,c.Z)(s,2))[0],f=l[1],Math.sqrt(Math.pow(i-u,2)+Math.pow(a-f,2))):t.radius;var n,r,o,i,a,s,l,u,f},getLineWidth:function(){return 2},lineWidthUnits:"pixels",getLineColor:function(e){return F(e,r)},filled:!0,getFillColor:[255,255,255,0],stroked:!0,pickable:!0,updateTriggers:{getLineColor:[r]}});return[o]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t?t.identifier:void 0),!0}}]),o}(W);Q.layerName="CircleAnnotationLayer",Q.defaultProps={id:{type:"string",value:"circle-annotation-layer",compare:!0},annotations:{type:"array",value:[{center:[0,0],radius:0,pixels:!1,visible:!0,lineColor:[0,0,0]}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var J=Q,X=n(3433),Y=n(4506);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation,o={coordinateSystem:w.Df.CARTESIAN,data:this.visibleAnnotations,getPath:function(t){var n=function(n){return r=t.pixels?e.unproject(n):n,[void 0===(i=(o=(0,c.Z)(r,2))[0])?0:i,void 0===(a=o[1])?0:a];var r,o,i,a},r=(0,Y.Z)(t.points),o=r[0],i=r.slice(1);return t.closed?[o].concat((0,X.Z)(i),[o]).map(n):[o].concat((0,X.Z)(i)).map(n)},getWidth:function(){return 2},widthUnits:"pixels",getColor:function(e){return F(e,r)},filled:!1,stroked:!0,pickable:!1,updateTriggers:{getColor:[r]}};return[new N.Z(te({id:"polylines-".concat(n)},o)),new N.Z(te(te({id:"polylines-pickable-".concat(n)},o),{},{getWidth:function(){return 6},getColor:function(){return[0,0,0,0]},pickable:!0}))]}}]),o}(W);ne.layerName="PolylineAnnotationLayer",ne.defaultProps={id:{type:"string",value:"polyline-annotation-layer",compare:!0},annotations:{type:"array",value:[{points:[[0,0]],pixels:!1,visible:!0,lineColor:[0,0,0],closed:!1}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var re=ne;var oe=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this.props,t=e.loader,n=e.id,r=P(t[0])||{},o=r.width,i=void 0===o?0:o,a=r.height,c=void 0===a?0:a,s=[{polygon:[[0,0],[i,0],[i,c],[0,c]]}];return[new j.Z({id:"annotation-background-layer-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:s,getLineWidth:function(){return 0},lineWidthUnits:"pixels",getLineColor:function(){return[0,0,0,0]},getFillColor:function(){return[0,0,0,0]},filled:!0,stroked:!1,pickable:!0})]}},{key:"onClick",value:function(){var e=this.props.onClick;return e&&e(void 0),!0}}]),o}(C.Z);oe.layerName="AnnotationBackgroundLayer",oe.defaultProps={loader:{type:"object",value:{getRaster:function(){var e=(0,g.Z)(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getRasterSize:function(){return{height:0,width:0}},dtype:"<u2"},compare:!0},id:{type:"string",value:"annotation-background-layer",compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var ie=oe,ae=n(1447);var ce=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation,o=this.visibleAnnotations.filter((function(e){return e.label&&e.label.value}));return[new ae.Z({id:"labels-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:o,getPosition:function(t){return n=t.pixels?e.unproject(t.center):t.center,[void 0===(o=(r=(0,c.Z)(n,2))[0])?0:o,void 0===(i=r[1])?0:i];var n,r,o,i},getText:function(e){return e.label?e.label.value:void 0},getSize:function(e){return e.label?e.label.fontSize:16},getColor:function(e){return F(e,r,(function(e){return e.label?e.label.color:void 0}))},getTextAnchor:"middle",getAlignmentBaseline:"center",filled:!0,getFillColor:[255,255,255,0],stroked:!0,pickable:!0,updateTriggers:{getLineColor:[r]}})]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t?t.identifier:void 0),!0}}]),o}(W);ce.layerName="TextAnnotationLayer",ce.defaultProps={id:{type:"string",value:"text-annotation-layer",compare:!0},annotations:{type:"array",value:[{center:[0,0],label:{color:"#FFFFFF",fontSize:16,value:""},visible:!0}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var se=ce;function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fe=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(e){var t;(0,p.Z)(this,o),t=r.call(this,e);var n=e.mesh,i=e.overlayImages,a=void 0===i?[]:i,c=e.annotations,s=void 0===c?[]:c,l=e.selectedAnnotation,u=e.onCellHover,f=e.hoveredCell,d=e.onCellClick,v=e.onSelectAnnotation;return t.onCellHover=u,t.hoveredCell=f,t.onCellClick=d,t.mesh=n,t.overlayImages=a,t.annotations=s,t.selectedAnnotation=l,t.onSelectAnnotation=v,t}return(0,d.Z)(o,[{key:"getLayers",value:function(e){var t=e.viewStates,n=e.props,r=(0,v.Z)((0,m.Z)(o.prototype),"getLayers",this).call(this,{viewStates:t,props:n}),i=n.loader,a=this.id,c=this.height,s=this.width,l=t[a];this.overlayImages&&this.overlayImages.forEach((function(e,t){var n,o,u,p;"string"==typeof e?(n=e,o=!0,u=.1):"object"===(0,f.Z)(e)&&e.url&&(n=e.url,o=!!(p=e.color)||!!e.ignoreColor,u=e.ignoreColorAccuracy||.1),n&&r.push(new T({loader:i,url:n,color:p,ignoreColor:o,ignoreColorAccuracy:u,id:"image-".concat(t,"-").concat(V(a)),viewState:ue(ue({},l),{},{height:c,width:s})}))})),this.mesh&&r.push(new x(ue(ue({},n),{},{loader:i,id:"mesh-".concat(V(a)),mesh:ue({},this.mesh),viewState:ue(ue({},l),{},{height:c,width:s}),onHover:this.onCellHover,onClick:this.onCellClick,hoveredCell:this.hoveredCell})));var u=this.annotations.filter((function(e){return/^rectangle$/i.test(e.type)})),p=this.annotations.filter((function(e){return/^circle$/i.test(e.type)})),d=this.annotations.filter((function(e){return/^polyline$/i.test(e.type)})),h=this.annotations.filter((function(e){return/^arrow$/i.test(e.type)})),y=this.annotations.filter((function(e){return/^text$/i.test(e.type)}));return this.annotations.length>0&&r.push(new ie(ue(ue({},this.props),{},{loader:i,id:"annotations-background-".concat(V(a)),viewState:ue(ue({},l),{},{height:c,width:s}),onClick:this.onSelectAnnotation}))),u.length>0&&r.push(new q(ue(ue({},this.props),{},{id:"rectangle-annotation-".concat(V(a)),viewState:ue(ue({},l),{},{height:c,width:s}),annotations:u,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation}))),p.length>0&&r.push(new J(ue(ue({},this.props),{},{id:"circle-annotation-".concat(V(a)),viewState:ue(ue({},l),{},{height:c,width:s}),annotations:p,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation}))),d.length>0&&r.push(new re(ue(ue({},this.props),{},{id:"polyline-annotation-".concat(V(a)),viewState:ue(ue({},l),{},{height:c,width:s}),annotations:d,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation}))),h.length>0&&r.push(new G(ue(ue({},this.props),{},{id:"arrow-annotation-".concat(V(a)),viewState:ue(ue({},l),{},{height:c,width:s}),annotations:h,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation}))),y.length>0&&r.push(new se(ue(ue({},this.props),{},{id:"text-annotation-".concat(V(a)),viewState:ue(ue({},l),{},{height:c,width:s}),annotations:y,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation}))),r}}]),o}(u.O6);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ve={handleValue:function(){},handleCoordinate:function(){}},he=[],ye=[255,255,255],me=[],ge=function(e){var t=e.loader,n=e.contrastLimits,r=e.colors,i=e.channelsVisible,a=e.viewStates,s=void 0===a?he:a,l=e.colormap,f=e.overview,p=e.overviewOn,d=e.selections,v=e.hoverHooks,h=void 0===v?ve:v,y=e.height,m=e.width,g=e.lensEnabled,b=void 0!==g&&g,O=e.lensSelection,w=void 0===O?0:O,C=e.lensRadius,j=void 0===C?100:C,Z=e.lensBorderColor,P=void 0===Z?ye:Z,k=e.lensBorderRadius,S=void 0===k?.02:k,A=e.clickCenter,x=void 0===A||A,R=e.transparentColor,D=e.onViewStateChange,L=e.onHover,E=e.onViewportLoad,I=e.extensions,M=void 0===I?me:I,z=e.deckProps,B=e.mesh,T=e.onCellClick,V=e.overlayImages,N=e.annotations,H=e.selectedAnnotation,F=e.onSelectAnnotation,U=null==s?void 0:s.find((function(e){return e.id===u.ys})),W=(0,o.useMemo)((function(){return U||(0,u.TI)(t,{height:y,width:m},.5)}),[t,U]),$=(0,o.useState)(void 0),G=(0,c.Z)($,2),_=G[0],q=G[1],K=(0,o.useCallback)((function(e){e&&!_?q(e):e?e&&_&&e.column!==_.column&&e.row!==_.row&&q(e):q(e)}),[_,q]),Q=new fe({id:u.ys,height:y,width:m,mesh:B,onCellHover:K,hoveredCell:_,onCellClick:T,overlayImages:V,annotations:N,selectedAnnotation:H,onSelectAnnotation:F}),J={loader:t,contrastLimits:n,colors:r,channelsVisible:i,selections:d,onViewportLoad:E,colormap:l,lensEnabled:b,lensSelection:w,lensRadius:j,lensBorderColor:P,lensBorderRadius:S,extensions:M,transparentColor:R},X=[],Y=[],ee=[];if(X.push(Q),Y.push(J),ee.push(de(de({},W),{},{id:u.ys})),p&&t){var te=(null==s?void 0:s.find((function(e){return e.id===u.cl})))||de(de({},W),{},{id:u.cl}),ne=new u.A6(de({id:u.cl,loader:t,detailHeight:y,detailWidth:m,clickCenter:x},f));X.push(ne),Y.push(de(de({},J),{},{lensEnabled:!1})),ee.push(te)}return t?o.createElement(u.iP,{layerProps:Y,views:X,viewStates:ee,hoverHooks:h,onViewStateChange:D,onHover:L,deckProps:z}):null},be="set-data",Oe="set-source-initializing",we="set-source",Ce="set-source-error",je="set-image",Ze="set-image-viewport-loaded",Pe="set-mesh",ke="set-overlay-images",Se="set-annotations",Ae="set-selected-annotation";function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Me=function(e,t){switch(t.type){case be:return function(e,t){var n=t.url,r=t.offsetsUrl,o=t.callback,i=e.url,a=e.offsetsUrl;return i===n&&r===a?(o&&o(),e):Re(Re({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,imageTimePosition:0,imageZPosition:0,mesh:void 0,source:void 0,sourcePending:!1,sourceError:!1,sourceCallback:o,error:void 0,url:n,offsetsUrl:r})}(e,t);case"set-error":return function(e,t){var n=t.error;return Le(Le({},e),{},{error:n})}(e,t);case Oe:return function(e){return Ie(Ie({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:void 0,sourcePending:!0,imagePending:!1,overlayImages:[],annotations:[],selectedAnnotation:void 0})}(e);case Ce:return function(e,t){var n=t.error,r=e.sourceCallback;return"function"==typeof r&&setTimeout((function(){r({error:n})}),0),Ie(Ie({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:n,sourcePending:!1,sourceCallback:void 0,overlayImages:[],annotations:[],selectedAnnotation:void 0})}(e,t);case we:return function(e,t){var n=t.source,r=e.sourceCallback;"function"==typeof r&&setTimeout((function(){r()}),0);var o=Array.isArray(n)?n:[n],i=o.map((function(e){return e.data})),a=o.map((function(e){return e.metadata}));return Ie(Ie({},e),{},{loader:i,metadata:a,imageIndex:0,source:n,sourceError:void 0,sourcePending:!1,sourceCallback:void 0,overlayImages:[],annotations:[],selectedAnnotation:void 0})}(e,t);case je:return function(e,t){var n,r=t.index,o=t.ID,i=t.Name,a=t.search,s=t.imageTimePosition,l=void 0===s?0:s,u=t.imageZPosition,f=void 0===u?0:u,p=t.mesh,d=t.overlayImages,v=void 0===d?[]:d,h=t.annotations,y=void 0===h?[]:h,m=t.selectedAnnotation,g=void 0===m?void 0:m,b=e.metadata,O=void 0===b?[]:b,w=e.imageIndex;if(null!=r)n=O[r];else if(void 0!==o)n=O.find((function(e){return e.ID===o}));else if(void 0!==i)n=O.find((function(e){return(e.Name||e.name||"").toLowerCase()===i.toLowerCase()}));else if(a&&/^[\d]+_[\d]+$/.test(a)){var C=/^([\d]+)_([\d])+$/.exec(a),j=(0,c.Z)(C,3),Z=j[1],P=j[2],k=new RegExp("^\\s*well\\s+".concat(Z,"\\s*,\\s*field\\s+").concat(P,"\\s*$"),"i");n=O.find((function(e){return k.test(e.Name||e.name)}))}if(n){var S=O.indexOf(n);return Ie(Ie({},e),{},{imageIndex:S,imagePending:w!==S,imageTimePosition:l,imageZPosition:f,mesh:p,overlayImages:v,annotations:y,selectedAnnotation:g})}return e}(e,t);case Ze:return function(e){return e.imagePending?Ie(Ie({},e),{},{imagePending:!1}):e}(e);case Pe:return function(e,t){var n=t.mesh;return Ie(Ie({},e),{},{mesh:n})}(e,t);case ke:return function(e,t){var n=t.overlayImages,r=void 0===n?[]:n;return Ie(Ie({},e),{},{overlayImages:r})}(e,t);case Se:return function(e,t){var n=t.annotations,r=void 0===n?[]:n;return Ie(Ie({},e),{},{annotations:r,selectedAnnotation:void 0})}(e,t);case Ae:return function(e,t){var n=t.selectedAnnotation;return Ie(Ie({},e),{},{selectedAnnotation:n})}(e,t);default:return e}},ze=n(2162),Be="set-default",Te="set-loading",Ve="set-loaded",Ne="set-error",He="set-channel-properties",Fe="set-default-channels-colors",Ue="set-color-map",We="set-lens-channel",$e="set-lens-enabled",Ge="set-global-position",_e="set-lock-channels";function qe(){var e=[];return{identifiers:[],channels:[],channelsVisibility:[],selections:e,builtForSelections:e,globalSelection:void 0,colors:[],domains:[],realDomains:[],contrastLimits:[],useLens:!1,useColorMap:!1,colorMap:"",lensEnabled:!1,lensChannel:0,use3D:!1,pixelValues:[],xSlice:[0,1],ySlice:[0,1],zSlice:[0,1],ready:!1,isRGB:!1,shapeIsInterleaved:!1,pending:!1,globalDimensions:[],metadata:void 0,loader:[],error:void 0,lockChannels:!1}}var Ke=n(5702);function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xe=n(4925),Ye=["channels","colors","domains","contrastLimits"];function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nt=[],rt=n(4477);function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var at=[],ct=[0,1];function st(e,t){switch(t.type){case Te:return it(it({},e),{},{pending:!0,error:void 0});case Ve:return it(it({},e),{},{pending:!1});case He:return function(e,t,n){var r=Object.entries(n||{}).filter((function(t){var n=(0,c.Z)(t,1)[0];return e&&e[n]&&Array.isArray(e[n])}));if(r.length>0){var o=Je({},e||{}),i=e.channels,a=(void 0===i?[]:i)[t];return r.forEach((function(e){var n=(0,c.Z)(e,2),r=n[0],i=n[1],s=o[r];o[r]=(0,X.Z)(s),o[r][t]=i,"colors"===r&&a&&Ke.bA.updateChannelColor(a,i)})),o}return e}(e,t.channel,t.properties);case Fe:return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e||{},r=n.channels,o=void 0===r?[]:r,i=n.colors,a=(void 0===i?[]:i).slice();return Object.entries(t).forEach((function(e){var t=(0,c.Z)(e,2),n=t[0],r=t[1],i=o.findIndex((function(e){return e===n}));i>=0&&(a[i]=r)})),Ke.bA.update(t),Je(Je({},e),{},{colors:a})}(e,t.defaultColors);case Ue:var n=t.colorMap,r=void 0===n?"":n;return e.useColorMap?it(it({},e),{},{colorMap:r}):e;case We:var o=t.lensChannel,i=void 0===o?0:o,s=e.lensEnabled,l=e.useLens;return s&&l?it(it({},e),{},{lensChannel:i}):e;case $e:var u=t.lensEnabled,f=void 0!==u&&u,p=e.lensEnabled,d=e.useLens;return it(it({},e),{},d&&!p&&f?{lensEnabled:f,lensChannel:0}:{lensEnabled:!1});case Ge:var v=t.position,h=void 0===v?{}:v,y=e.globalDimensions,m=void 0===y?[]:y,g=e.selections,b=void 0===g?[]:g,O=e.globalSelection,w=void 0===O?{}:O,C=function(e,t){var n=(m.find((function(t){return t.label===e}))||{}).size,r=void 0===n?0:n;return Math.max(0,Math.min(r,Math.round(t)))},j=Object.entries(h).filter((function(e){var t=(0,c.Z)(e,1)[0];return rt.Z.includes(t)&&m.find((function(e){return e.label===t}))})).map((function(e){var t=(0,c.Z)(e,2),n=t[0],r=t[1];return{dimension:n,position:C(n,r)}}));if(j.length>0){var Z=j.map((function(e){var t=e.dimension,n=e.position;return(0,a.Z)({},t,n)})).reduce((function(e,t){return it(it({},e),t)}),{}),P=it(it({},w),Z),k=b.map((function(e){return it(it({},e),Z)}));return it(it({},e),{},{selections:k,globalSelection:P})}return e;case _e:var S=t.lock,A=e.channels,x=void 0===A?at:A,R=e.contrastLimits,D=void 0===R?at:R,L=e.realDomains,E=void 0===L?at:L,I=it(it({},e),{},{lockChannels:S}),M=Array.isArray(S)?S.slice():S?x.slice():[];return I.domains=(I.domains||[]).map((function(e,t){return M.includes(x[t])?e:E[t]||e})),I.contrastLimits=D.map((function(e,t){if(M.includes(x[t]))return e;var n=I.domains[t];if(n&&Array.isArray(n)&&2===n.length){var r=(0,Y.Z)(e),o=r[0],i=r[1],a=r.slice(2),s=(0,c.Z)(n,2),l=s[0],u=s[1],f=function(e){return Math.max(l,Math.min(u,e))};return[f(o),f(i)].concat((0,X.Z)(a))}return e})),I;case Be:var z=function(e,t){var n=e||{},r=n.lockChannels,o=void 0!==r&&r,i=n.channels,a=void 0===i?nt:i,c=n.colors,s=void 0===c?nt:c,l=n.domains,u=void 0===l?nt:l,f=n.contrastLimits,p=void 0===f?nt:f,d=n.channelsVisibility,v=void 0===d?nt:d,h=t||{},y=h.channels,m=void 0===y?nt:y,g=h.colors,b=void 0===g?nt:g,O=h.domains,w=void 0===O?nt:O,C=h.contrastLimits,j=void 0===C?nt:C,Z=(0,Xe.Z)(h,Ye);if(!o||Array.isArray(o)&&0===o.length)return tt(tt({},Z),{},{channels:m,colors:b,domains:w,contrastLimits:j,realDomains:w.slice(),channelsVisibility:m.map((function(){return!0}))});if(0===m.length)return e;for(var P=Array.isArray(o)?o:m.slice(),k=a.slice(),S=[],A=0;A<m.length;A+=1){var x=k.indexOf(m[A]);P.includes(m[A])&&-1!==x?(k.splice(x,1,void 0),S.push({channel:m[A],color:s[x]||b[A],domain:u[x]||w[A],realDomain:w[A].slice(),contrastLimits:p[x]||j[A],visibility:void 0===v[x]||v[x]})):S.push({channel:m[A],color:b[A],domain:w[A],realDomain:w[A].slice(),contrastLimits:j[A],visibility:!0})}return tt(tt({},Z),{},{channels:S.map((function(e){return e.channel})),colors:S.map((function(e){return e.color})),domains:S.map((function(e){return e.domain})),realDomains:S.map((function(e){return e.realDomain})),contrastLimits:S.map((function(e){return e.contrastLimits})),channelsVisibility:S.map((function(e){return e.visibility}))})}(e,t),B=z.channels,T=void 0===B?at:B,V=z.channelsVisibility,N=void 0===V?at:V,H=z.selections,F=void 0===H?at:H,U=z.colors,W=void 0===U?at:U,$=z.domains,G=void 0===$?at:$,_=z.realDomains,q=void 0===_?G.slice():_,K=z.contrastLimits,Q=void 0===K?at:K,J=z.useLens,ee=void 0!==J&&J,te=z.useColorMap,ne=void 0!==te&&te,re=z.colorMap,oe=void 0===re?ne?e.colorMap:"":re,ie=z.lensEnabled,ae=void 0!==ie&&ie,ce=z.lensChannel,se=void 0===ce?0:ce,le=z.xSlice,ue=void 0===le?ct:le,fe=z.ySlice,pe=void 0===fe?ct:fe,de=z.zSlice,ve=void 0===de?ct:de,he=z.use3D,ye=void 0!==he&&he,me=z.ready,ge=void 0!==me&&me,be=z.isRGB,Oe=void 0!==be&&be,we=z.shapeIsInterleaved,Ce=void 0!==we&&we,je=z.globalDimensions,Ze=void 0===je?at:je,Pe=z.metadata,ke=z.loader;return it(it({},e),{},{identifiers:T.map((function(e,t){return"".concat(e||"channel","-").concat(t)})),channels:T,channelsVisibility:N,selections:F,builtForSelections:F,globalSelection:(F||[])[0],pixelValues:new Array((F||[]).length).fill("-----"),colors:W,domains:G,realDomains:q,contrastLimits:Q,useLens:ee,useColorMap:ne,colorMap:oe,lensEnabled:ae,lensChannel:se,xSlice:ue,ySlice:pe,zSlice:ve,use3D:ye,ready:ge,isRGB:Oe,shapeIsInterleaved:Ce,globalDimensions:Ze,error:void 0,metadata:Pe,loader:ke});case Ne:var Se=t.error;return it(it({},e),{},{error:Se,pending:!1});default:return e}}var lt=n(5451);function ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ut(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ut(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pt(e,t){for(var n=[],r=ft(ft({},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rt.Z;return e.labels.filter((function(e){return t.includes(e)})).map((function(e){return(0,a.Z)({},e,0)})).reduce((function(e,t){return ft(ft({},e),t)}),{})}(e)),t||{}),o=e.labels.map((function(t,n){return{name:t,size:e.shape[n]}})).find((function(e){return!rt.Z.includes(e.name)&&e.size})),i=0;i<Math.min(4,o.size);i+=1)n.push(ft((0,a.Z)({},o.name,i),r));return Z(e.shape)?[ft(ft({},n[0]),{},{c:0})]:n}function dt(e){return vt.apply(this,arguments)}function vt(){return(vt=(0,g.Z)(O().mark((function e(t){var n,r,o,i,a,c,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=Array.isArray(n)?n[n.length-1]:n,e.next=4,o.getRaster({selection:r});case 4:return i=e.sent,a=(0,u.mx)(i.data),c=a.domain,s=a.contrastLimits,e.abrupt("return",{domain:c,contrastLimits:s});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ht(e){return yt.apply(this,arguments)}function yt(){return(yt=(0,g.Z)(O().mark((function e(t){var n,r,o,i,a,c,s,l,f,p,d,v;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=n[n.length-1],i=o.shape,a=o.labels,c=i[a.indexOf("z")]>>n.length-1,e.next=6,o.getRaster({selection:ft(ft({},r),{},{z:0})});case 6:return s=e.sent,e.next=9,o.getRaster({selection:ft(ft({},r),{},{z:Math.floor(c/2)})});case 9:return l=e.sent,e.next=12,o.getRaster({selection:ft(ft({},r),{},{z:Math.max(0,c-1)})});case 12:return f=e.sent,p=(0,u.mx)(s.data),d=(0,u.mx)(l.data),v=(0,u.mx)(f.data),e.abrupt("return",{domain:[Math.min(p.domain[0],d.domain[0],v.domain[0]),Math.max(p.domain[1],d.domain[1],v.domain[1])],contrastLimits:[Math.min(p.contrastLimits[0],d.contrastLimits[0],v.contrastLimits[0]),Math.max(p.contrastLimits[1],d.contrastLimits[1],v.contrastLimits[1])]});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mt(e){return gt.apply(this,arguments)}function gt(){return(gt=(0,g.Z)(O().mark((function e(t){var n,r,o,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=t.use3d,i=o?ht:dt,e.abrupt("return",i({loader:n,selection:r}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bt(e){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,g.Z)(O().mark((function e(t){var n,r,o,i,a,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selections,o=t.use3d,e.next=3,Promise.all(r.map((function(e){return mt({loader:n,selection:e,use3d:o})})));case 3:return i=e.sent,a=i.map((function(e){return e.domain})),c=i.map((function(e){return e.contrastLimits})),e.abrupt("return",{domains:a,contrastLimits:c});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wt(e){var t=Array.isArray(e)?e[0]:e,n=t.shape,r=t.labels,o=function(e){var t,n,r=null!==(t=null==e||null===(n=e.meta)||void 0===n?void 0:n.physicalSizes)&&void 0!==t?t:{},o=r.x,i=r.y,a=r.z;if(null!=o&&o.size&&null!=i&&i.size&&null!=a&&a.size){var c=Math.min(a.size,o.size,i.size),s=[o.size/c,i.size/c,a.size/c];return(new lt.Z).scale(s)}return(new lt.Z).identity()}(t);return[[0,o[0]*n[r.indexOf("x")]],[0,o[5]*n[r.indexOf("y")]],[0,o[10]*n[r.indexOf("z")]]]}function Ct(e){var t=e.Pixels||{},n=t.Channels,r=void 0===n?[]:n,o=t.SizeC,i=void 0===o?0:o,a=t.Interleaved,c=void 0!==a&&a,s=t.Type,l=r.length,u=(r[0]||{}).SamplesPerPixel;return 3===(void 0===u?0:u)||3===l&&"uint8"===s||3===i&&1===l&&c}var jt=[0,255];function Zt(e,t){return e.Name||e.name||e.ID||"Channel ".concat(t+1)}function Pt(e,t,n,r){return kt.apply(this,arguments)}function kt(){return(kt=(0,g.Z)(O().mark((function e(t,n,r,o){var i,a,s,l,u,f,p,d,v,h,y,m,g,b,w,C,j,P,k,S,A,x,R,D;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t[0]||{},a=i.shape,s=i.labels,l=(void 0===s?[]:s).map((function(e,t){return{label:e,size:a[t]||0}})).filter((function(e){return e.size>1&&rt.Z.includes(e.label)})),u=r||pt(t[0],o),f=n.Pixels,p=(void 0===f?{}:f).Channels,d=void 0===p?[]:p,v=[],h=[],y=[],m=!1,g=!1,b=Ct(n),w=b&&Z(a),C=d.map(Zt),!b){e.next=19;break}Z(a)?(v=[jt.slice()],y=[jt.slice()],h=[Ke.Q6]):(v=[jt.slice(),jt.slice(),jt.slice()],y=[jt.slice(),jt.slice(),jt.slice()],h=[Ke.Q6,Ke.ek,Ke.iN]),m=!1,g=!1,e.next=28;break;case 19:return e.next=21,bt({loader:t,selections:u,use3d:!1});case 21:for(j=e.sent,y=j.domains.slice(),v=j.contrastLimits.slice(),h=[],P=0;P<C.length;P+=1)(k=Ke.bA.getColorForChannel(C[P]))?h.push(k):1===C.length?h.push(Ke.ix):h.push(Ke.ZP[h.length%Ke.ZP.length]);m=d.length>1,g=!0;case 28:return S=wt(t),A=(0,c.Z)(S,3),x=A[0],R=A[1],D=A[2],e.abrupt("return",{channels:C,selections:u,useLens:m,useColorMap:g,colors:h,domains:y,contrastLimits:v,xSlice:x,ySlice:R,zSlice:D,ready:!0,isRGB:b,shapeIsInterleaved:w,globalDimensions:l,metadata:n,loader:t});case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function St(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function At(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?St(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):St(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.selections,a=r.cache,c=r.imageTimePosition,s=void 0===c?0:c,l=r.imageZPosition,u=void 0===l?0:l,f=(0,o.useRef)(0);(0,o.useEffect)((function(){var r=e&&t&&e.Pixels&&t.length;if(r&&(i&&i!==a||!i)){n({type:Te}),f.current+=1;var o=f.current;Pt(t,e,i,s||u?{t:s,z:u}:void 0).then((function(e){o===f.current&&n(At({type:Be},e))})).catch((function(e){console.warn("HCS Image Viewer error: ".concat(e.message)),console.error(e),n({type:Ne,error:e.message})}))}else r||n({type:Be})}),[e,t,s,u,i,a,f,n])}function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Lt(){return{}}function Et(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Array.isArray(e)?e[0]:e,o=P(r);if(o&&t){var i=o.width,a=o.height;return Math.log2(Math.min(t.width/i,t.height/a))-n}return-1/0}function It(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?It(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zt=new u.$h,Bt=new u.z6,Tt={glOptions:{preserveDrawingBuffer:!0}},Vt=[zt],Nt=[Bt];function Ht(e){var t=e.className,n=e.onStateChange,r=e.onRegisterStateActions,i=e.onViewerStateChanged,a=e.onProjectionChanged,s=e.style,l=e.minZoomBackOff,f=void 0===l?0:l,p=e.maxZoomBackOff,d=void 0===p?void 0:p,v=e.defaultZoomBackOff,h=void 0===v?0:v,y=e.overview,m=e.onCellClick,g=function(){var e=(0,o.useReducer)(Me,{},Lt),t=(0,c.Z)(e,2),n=t[0],r=t[1];!function(e,t){var n=e||{},r=n.url,i=n.offsetsUrl;n.source,(0,o.useEffect)((function(){r&&(t({type:Oe}),(0,ze.C)({url:r,offsetsUrl:i}).then((function(e){return t({type:we,source:e})})).catch((function(e){return t({type:Ce,error:e.message})})))}),[r,i,t])}(n,r);var i=function(e){var t=(0,o.useReducer)(st,{},qe),n=(0,c.Z)(t,2),r=n[0],i=n[1],a=function(e){var t=e.imageIndex,n=void 0===t?0:t,r=e.metadata,o=void 0===r?[]:r;if(!(n<0||n>=o.length))return o[n]}(e),s=function(e){var t=e.imageIndex,n=void 0===t?0:t,r=e.loader,o=void 0===r?[]:r;if(!(n<0||n>=o.length))return o[n]}(e),l=e.imageTimePosition,u=void 0===l?0:l,f=e.imageZPosition,p=void 0===f?0:f,d=r.metadata,v=r.loader,h=r.selections,y=r.builtForSelections;return xt(a,s,i,(0,o.useMemo)((function(){return{imageTimePosition:u,imageZPosition:p}}),[u,p])),xt(d,v,i,(0,o.useMemo)((function(){return{selections:h,cache:y}}),[h,y])),{state:r,dispatch:i}}(n),a=i.state,s=i.dispatch,l=(0,o.useCallback)((function(e,t,n){r({url:e,offsetsUrl:t,callback:n,type:be})}),[r]),u=(0,o.useCallback)((function(e){r(Dt({type:je},e))}),[r]),f=(0,o.useCallback)((function(e){r({type:Pe,mesh:e})}),[r]),p=(0,o.useCallback)((function(){r({type:ke,overlayImages:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]})}),[r]),d=(0,o.useCallback)((function(){r({type:Se,annotations:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]})}),[r]),v=(0,o.useCallback)((function(e){r({type:Ae,selectedAnnotation:e})}),[r]),h=(0,o.useCallback)((function(e){r(Dt({type:Ze},e)),s({type:Ve})}),[r,s]),y=(0,o.useCallback)((function(){s({type:Te})}),[s]),m=(0,o.useCallback)((function(e,t){s({type:He,channel:e,properties:t})}),[s]),g=(0,o.useCallback)((function(){s({type:Fe,defaultColors:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}})}),[s]),b=(0,o.useCallback)((function(e){s({type:Ue,colorMap:e})}),[s]),O=(0,o.useCallback)((function(e){s({type:$e,lensEnabled:e})}),[s]),w=(0,o.useCallback)((function(e){s({type:We,lensChannel:e})}),[s]),C=(0,o.useCallback)((function(e){s({type:Ge,position:e})}),[s]),j=(0,o.useCallback)((function(e){s({type:_e,lock:e})}),[s]);return{callbacks:(0,o.useMemo)((function(){return{setData:l,setImage:u,setImageViewportLoading:y,setImageViewportLoaded:h,setChannelProperties:m,setDefaultChannelsColors:g,setColorMap:b,setLensEnabled:O,setLensChannel:w,setGlobalPosition:C,setLockChannels:j,setMesh:f,setOverlayImages:p,setAnnotations:d,setSelectedAnnotation:v}}),[l,u,y,h,m,g,b,O,w,C,j,f,p,d,v]),dispatch:r,state:n,viewerState:a,viewerDispatch:s}}(),b=g.state,O=g.viewerState,w=g.callbacks,C=b.mesh,j=b.overlayImages,Z=b.annotations,P=b.selectedAnnotation,k=b.pending,S=(0,o.useRef)(),A=function(e){var t=(0,o.useState)({width:void 0,height:void 0}),n=(0,c.Z)(t,2),r=n[0],i=n[1];return(0,o.useEffect)((function(){var t,n,r;return function o(){var a,c,s=null==e||null===(a=e.current)||void 0===a?void 0:a.clientWidth,l=null==e||null===(c=e.current)||void 0===c?void 0:c.clientHeight;e&&e.current&&(s!==t||l!==n)&&i({width:t=s,height:n=l}),r=requestAnimationFrame(o)}(),function(){return cancelAnimationFrame(r)}}),[e,i]),r}(S),x=w.setSelectedAnnotation,R=(0,o.useCallback)((function(e){P!==e&&x(e)}),[P,x]),D=(0,o.useState)(void 0),L=(0,c.Z)(D,2),E=L[0],I=L[1],M=(0,o.useCallback)((function(e){var t=(e||{}).viewState;if(t){var n=t.width,r=t.height,o=t.zoom,i=t.target,a=Math.pow(2,o);I({scale:a,width:n,height:r,position:i})}}),[I]);(0,o.useEffect)((function(){n&&n(b)}),[b,n]),(0,o.useEffect)((function(){i&&i(O)}),[O,i]),(0,o.useEffect)((function(){if(a){var e=E||{},t=e.width,n=void 0===t?0:t,r=e.height,o=void 0===r?0:r,i=e.scale,c=void 0===i?1:i,s=e.position,l=void 0===s?[0,0]:s;a((function(e){var t=[e[0]-n/2,e[1]-o/2];return[l[0]+t[0]/c,l[1]+t[1]/c]}))}}),[E,a]),(0,o.useEffect)((function(){r&&r(w)}),[w,r]);var z=w||{},B=z.setImageViewportLoading,T=z.setImageViewportLoaded,V=O.channelsVisibility,N=void 0===V?[]:V,H=O.contrastLimits,F=void 0===H?[]:H,U=O.colors,W=void 0===U?[]:U,$=O.selections,G=void 0===$?[]:$,_=O.ready,q=void 0!==_&&_,K=O.colorMap,Q=O.loader,J=O.useLens,X=O.lensEnabled,Y=O.lensChannel,ee=O.pending;(0,o.useEffect)((function(){"function"==typeof B&&B()}),[G,Q,B]);var te=(0,o.useState)(void 0),ne=(0,c.Z)(te,2),re=ne[0],oe=ne[1];(0,o.useEffect)((function(){if(Q&&Q.length&&A.width&&A.height){var e=Array.isArray(Q)?Q:[Q],t=(0,c.Z)(e,1)[0],n=Array.isArray(Q)?Q[Q.length-1]:Q,r=Mt(Mt({},(0,u.TI)(Q,A,h)),{},{id:u.ys,minZoom:void 0!==f?Et(t,A,f):-1/0,maxZoom:void 0!==d?Et(n,A,d):1/0});oe([r]),M({viewState:Mt({width:A.width,height:A.height},r)})}else oe(void 0),M({})}),[Q,A,oe,f,d,h,M]);var ie=Q&&q&&A.width&&A.height&&re;return o.createElement("div",{className:t,style:Mt({position:"relative"},s||{}),ref:S},ie&&o.createElement(ge,{mesh:k||ee?void 0:C,overlayImages:j,annotations:Z,selectedAnnotation:P,onSelectAnnotation:R,contrastLimits:F,colors:W,channelsVisible:N,loader:Q,selections:G,height:A.height,width:A.width,extensions:K?Vt:Nt,colormap:K||"viridis",onViewportLoad:T,viewStates:re,overviewOn:!!y,overview:y,lensSelection:J&&X?Y:void 0,lensEnabled:J&&X,onCellClick:m,onViewStateChange:M,deckProps:Tt}))}Ht.propTypes={className:l().string,onStateChange:l().func,onRegisterStateActions:l().func,onViewerStateChanged:l().func,onProjectionChanged:l().func,style:l().object,minZoomBackOff:l().number,maxZoomBackOff:l().number,defaultZoomBackOff:l().number,overview:l().object,onCellClick:l().func},Ht.defaultProps={className:void 0,onStateChange:void 0,onRegisterStateActions:void 0,onViewerStateChanged:void 0,onProjectionChanged:void 0,style:void 0,minZoomBackOff:0,maxZoomBackOff:void 0,defaultZoomBackOff:0,overview:void 0,onCellClick:void 0};var Ft=Ht;function Ut(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.onStateChange,c=n.onRegisterStateActions,s=n.onViewerStateChanged,l=n.onProjectionChanged,u=n.onCellClick;i.render(o.createElement(Ft,(0,r.Z)({onRegisterStateActions:c,onStateChange:a,onViewerStateChanged:s,onProjectionChanged:l,onCellClick:u},t)),e)}}}]);